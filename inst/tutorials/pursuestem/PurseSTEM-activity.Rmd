---
title: "Pursue STEM activity"
subtitle: "Visualizing"
output: learnr::tutorial
css: "css/learnr_303.css"
runtime: shiny_prerendered
---

```{r setup, include = FALSE}
# These are the packages you will need for this activity
packages_needed <- c("tidyverse", "learnr")

package.check <- lapply(
  packages_needed,
  FUN = function(x) {
    if (!require(x, character.only = TRUE)) {
      install.packages(x, dependencies = TRUE, repos = "http://cran.us.r-project.org")
    }
  }
)

# Credit: package.check based on a helpful post from Vikram Baliga https://vbaliga.github.io/verify-that-r-packages-are-installed-and-loaded/

library(learnr)
library(tidyverse)

knitr::opts_chunk$set(echo = FALSE)

avengers <- read_csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/avengers/avengers.csv")

```

## Instructions

In this activity you're going to be choossing one or more of the artists you/your fellow students suggested and explore the 'mood' of their music. 



## Data dictionary

|variable                 |class     |description |
|:---|:---|:-----------|
|artist_name             |character | Song artist|
|artist_popularity       |number | Popularity score (0-100) based on track play and recency. Higher is better |
|artist_followers        |number | Number of people who 'follow' the artist on Spotify|
|album_name              |character| Name of the album the song if from |
|album_release_year      |number | Year of album release|
|track_name              |character | Song name|
|danceability            |number    | Danceability describes how suitable a track is for dancing based on a combination of musical elements including tempo, rhythm stability, beat strength, and overall regularity. A value of 0.0 is least danceable and 1.0 is most danceable. |
|energy                   |number    | Energy is a measure from 0.0 to 1.0 and represents a perceptual measure of intensity and activity. Typically, energetic tracks feel fast, loud, and noisy. For example, death metal has high energy, while a Bach prelude scores low on the scale. Perceptual features contributing to this attribute include dynamic range, perceived loudness, timbre, onset rate, and general entropy. |
|loudness                 |number    | The overall loudness of a track in decibels (dB). Loudness values are averaged across the entire track and are useful for comparing relative loudness of tracks. Loudness is the quality of a sound that is the primary psychological correlate of physical strength (amplitude). Values typical range between -60 and 0 db.|
|speechiness              |number    | Speechiness detects the presence of spoken words in a track. The more exclusively speech-like the recording (e.g. talk show, audio book, poetry), the closer to 1.0 the attribute value. Values above 0.66 describe tracks that are probably made entirely of spoken words. Values between 0.33 and 0.66 describe tracks that may contain both music and speech, either in sections or layered, including such cases as rap music. Values below 0.33 most likely represent music and other non-speech-like tracks. |
|acousticness             |number    | A confidence measure from 0.0 to 1.0 of whether the track is acoustic. 1.0 represents high confidence the track is acoustic.|
|instrumentalness         |number    | Predicts whether a track contains no vocals. “Ooh” and “aah” sounds are treated as instrumental in this context. Rap or spoken word tracks are clearly “vocal”. The closer the instrumentalness value is to 1.0, the greater likelihood the track contains no vocal content. Values above 0.5 are intended to represent instrumental tracks, but confidence is higher as the value approaches 1.0. |
|liveness                 |number    | Detects the presence of an audience in the recording. Higher liveness values represent an increased probability that the track was performed live. A value above 0.8 provides strong likelihood that the track is live. |
|valence                  |number    | A measure from 0.0 to 1.0 describing the musical positiveness conveyed by a track. Tracks with high valence sound more positive (e.g. happy, cheerful, euphoric), while tracks with low valence sound more negative (e.g. sad, depressed, angry). |
|tempo                    |number    | The overall estimated tempo of a track in beats per minute (BPM). In musical terminology, tempo is the speed or pace of a given piece and derives directly from the average beat duration. |
|mode_name                    |character    | Mode indicates the modality (major or minor) of a track, the type of scale from which its melodic content is derived. |
|duration_ms                    |number    | Length of the song in miliseconds. |
|explicit                       |logical   | Is the song rated explicit? |
|artist_genre                   |character | This variable is still a little messy, but you can see the genres that the artist's music is considered to belong to.|




```{r}
glimpse(avengers)
```

# Your turn!

```{r table, exercise = TRUE, exercise.setup = "setup"}

```

```{r table-hint-1}
# If the data isn't loading, add this to your code
avengers <- read_csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/avengers/avengers.csv")

# If a variable name has spaces or other weird characters
# you can put it in back ticks to have it run
avengers$`Current?`
```

```{r table-hint-2}
# The first variable will be your rows, the second your columns
```

```{r table-solution}
table1 <- table(avengers$`Current?`, avengers$Death1)
```

How many of the current (as of 2015) Avengers characters have died at least once?

**
A. 25  
B. 47       
C. 44     
D. 57  
**

```{r q1, include=TRUE}
question("What is the correct answer?",
         answer("A", correct = TRUE),
         answer("B"),
         answer("C"),
         answer("D"),
         message = "You want the yes/yes value from the table, if the table is constructed correctly."
)
```

## Question 2

What would be the appropriate code to find the conditional probability that an Avenger has died (at least once), given the fact that they are no longer an Avenger.

```{r cond, exercise = TRUE, exercise.setup = "table"}
# If you want to test the code here, you may need to copy your table code from the previous question
```


```{r cond-hint}
# Margin 1 is rows, margin 2 is columns
```

```{r cond-solution}
prop.table(table1, margin = 1)
```

Which line of code will achieve this?

**
A. `prop.table(table1, margin = 1)`  
B. `prop.table(table1, margin = 2)`  
C. `margin.table(table1, margin = 1)/sum(table1)`  
D. `margin.table(table1, margin = 2)/sum(table1)`  
**

```{r q2, include=TRUE}
question("What is the correct answer?",
         answer("A", correct = TRUE),
         answer("B"),
         answer("C"),
         answer("D"),
         message = "With current status as the row variable of the table, you want margin 1 (rows) and prop.table() is the correct function."
)
```

## Question 3

What are the __odds__ of an Avengers character dying (at least once)? Note: this is regardless of current status.

```{r odds, exercise = TRUE, exercise.setup = "table"}
# You may wish to copy your table code in again. 
```

```{r, odds-hint}
# To get the overall death counts you could run:
margin.table(table1, margin = 2)

# Or just run
table(avengers$Death1)
```


**
A. 0.40  
B. 0.60  
C. 0.66  
D. 1.51  
**

```{r q3, include=TRUE}
question("What is the correct answer?",
         answer("A"),
         answer("B"),
         answer("C", correct = TRUE),
         answer("D"),
         message = "69/104 (number who died / number who haven't died)"
)
```

## Question 4

What is the risk ratio of dying for current Avengers vs 'not current' Avengers?

```{r risk, exercise = TRUE, exercise.setup = "table"}
# You can do calculations here, if you like
```

**
A. 0.57  
B. 0.63  
C. 1.21  
D. 1.59  
**

```{r q4, include=TRUE}
question("What is the correct answer?",
         answer("A"),
         answer("B", correct = TRUE),
         answer("C"),
         answer("D"),
         message = "(25/(25+57))/(44/(44+47))"
)
```

## Question 5

Suppose I said I got an odds ratio of 1 when comparing deaths by gender (female, male in this dataset) for Avengers. Without any further information or calculations, which ONE of the following conclusions could you make?

**
A. The count of Avengers who have died at least once is the same for females and males.  
B. The proportion of Avengers who have died at least once is the same for females and males.  
C. One gender had 100% more deaths than the other.  
D. There is a 50/50 chance that a given Avenger is a female who died vs a male who died.
**

```{r q5, include=TRUE}
question("What is the correct answer?",
         answer("A"),
         answer("B", correct = TRUE),
         answer("C"),
         answer("D"),
         message = "We cannot claim the counts are the same, but we can claim that the proportions should be the same as our numerator and denominator values must be the same. We can't say '100% more' because we can't comment on counts, and D incorrectly conditions on everyone being dead."
)
```

## Question 6

Fit an appropriate model to investigate the association of `Death1`, that has `Death1` as the response variable, and uses current status, gender and number of appearances in comics as the explanatory variables. 

Save this model as `glm_mod` (i.e., assign it this name).

Get 95% confidence intervals for the coefficients. (Code given.)


```{r model, exercise = TRUE, exercise.setup = "setup"}
# Convert y into 0s and 1s (1 = death)
binary_y <- if_else(avengers$Death1 == "YES", 1, 0)
# Your model here
glm_mod <- glm(binary_y~_____________, ______________ , data = avengers)

confint(glm_mod)
```

```{r model-hint-1}
?glm
```

```{r model-hint-2}
# You can tell R you want to do logistic regression (with the logit link)
# with this statement inside your function
family = binomial(link = "logit")
```

```{r model-solution}
glm_mod <- glm(binary_y ~ `Current?` + Gender + Appearances, family = binomial(link = "logit"), data = avengers)

confint(glm_mod)
```

Which ONE of the following claims is FALSE.

**
A. It is plausible that the baseline group (non-current, female avengers with 0 appearances) has odds of dying of 0.  
B. When adjusted for gender and number of appearance, the odds of having died at least once is lower for current avengers than for 'not current' avengers.  
C. At the 95% level, there is no evidence that male avengers have a higher odds of dying than female avengers, after accounting for current status and number of appearances.  
D. Characters with more appearances in the comics have greater odds of dying, after controlling for current status and gender.
**

```{r q7, include=TRUE}
question("What is the correct answer?",
         answer("A", correct = TRUE),
         answer("B"),
         answer("C"),
         answer("D"),
         message = "A is false because it is plausible that the LOG odds are no different from 0, but when it comes to the odds scale (after exponentiating) it would be 1 we're claiming is in the interval."
)
```

## Question 7

What is this code doing?

```{r center, exercise = TRUE, exercise.setup = "setup"}
summary(avengers$Appearances)
avengers$Appearances_c <- (avengers$Appearances - 132)/100
```

**
A. Overwriting the `Appearances` variable with a version centered on the median number of appearances and rescaled to be in the 100s.  
B. Creating a new binary variable where 0 indicates the person had the median number of appearances and 1 indicates they did not.  
C. Creating a new numeric variable centered on the median number of appearances and rescaled to be in the 100s.  
D. Creating a new data frame with just one vector, a centered version of the `Appearances` variable, rescaled to be in the 100s.
**

```{r q8, include=TRUE}
question("What is the correct answer?",
         answer("A"),
         answer("B"),
         answer("C", correct = TRUE),
         answer("D"),
         message = "132 is the median number of appearances. This code creates a new variable called Appearances_c that is centered on the median. We want to do this so that our intercept interpretation is more meaningful."
)
```

## Question 8

What is estimated percentage difference in odds of dying (at least once) for an Avenger with 100 more appearances than another (assuming gender and current status are the same for both).

```{r final, exercise = TRUE, exercise.setup = "setup"}
# Convert y into 0s and 1s (1 = death)
binary_y <- if_else(avengers$Death1 == "YES", 1, 0)

# From previous question
avengers$Appearances_c <- (avengers$Appearances - 132)/100

# Fit the model
glm_mod_2 <- glm(binary_y ~ `Current?` + Gender + Appearances_c, family = binomial(link = "logit"), data = avengers)

exp(summary(glm_mod_2)$coeff[,1])

# You may want to add additional code, or not.
```

**
A. The avenger with 100 more appearances has 8% _higher_ odds of having died at least once.  
B. The avenger with 100 more appearances has 8% _lower_ odds of having died at least once.  
C. The avenger with 100 more appearances has 108% _higher_ odds of having died at least once.  
D. The avenger with 100 more appearances has 108% _lower_ odds of having died at least once.
**

```{r q9, include=TRUE}
question("What is the correct answer?",
         answer("A", correct = TRUE),
         answer("B"),
         answer("C"),
         answer("D"),
         message = "1.08 is the correct coefficient to interpret. Multiplication by 1.08 is an 8% increase. Our new centered and scaled variable means we can interpret this directly in this way."
)
```

## Question 9

Which one of the following is the most reasonable guess about the odds that Prof. B has been watching WandaVision?

**
A. Much great than 1  
B. Slightly greater than 1  
C. 1  
D. Less than 1
**

```{r q10, include=TRUE}
question("What is the correct answer?",
         answer("A"),
         answer("B", correct = TRUE),
         answer("C"),
         answer("D"),
         message = "Odds much greater than 1 mean it is much more likely that I have been watching it than that I haven't. The before-class music was WandaVision songs, their comic picture is on the data page, and this was the whole inspiration for this week's data. It is a fairly safe bet that I've been watching WandaVision :D"
)
```
